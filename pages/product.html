<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#1b1b20">
    <title>BODA Product Detail</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <script src="../assets/js/product-detail.config.js"></script>
    <script src="../assets/vendor/tailwind/tailwind-forms-container-queries.js"></script>
    <link href="../assets/css/product-detail.css" rel="stylesheet"/>
    <link href="../assets/fonts/inter.css" rel="stylesheet"/>
    <link href="../assets/fonts/material-icons-outlined.css" rel="stylesheet"/>
    <script src="../assets/vendor/tailwind/tailwind-forms-typography.js"></script>
    <link href="../assets/css/home.css" rel="stylesheet"/>
    <script src="../assets/vendor/tailwind/tailwind-forms-typography.js"></script>
<link href="../assets/fonts/inter.css" rel="stylesheet"/>
<script src="../assets/js/home.config.js"></script>
<script src="../assets/vendor/tailwind/tailwind-forms-typography.js"></script>
<link href="../assets/fonts/inter.css" rel="stylesheet"/>
<link href="../assets/fonts/material-icons-outlined.css" rel="stylesheet"/>
<link href="../assets/css/home.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../tfasil/src/output.css" />
<!-- signup/signin CSS not required here -->
    <style>
        /* Specific styles for product details that extend the main theme */
        
        .product-main {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            padding: 3rem 0;
            align-items: start;
        }

        /* Gallery */
        .gallery-wrap {
            position: sticky;
            top: 120px;
        }

        .main-img-container {
            width: 100%;
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .main-img-container img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: all 0.3s ease;
        }

        .thumbs-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.8rem;
        }

        .thumb {
            aspect-ratio: 1;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
        }

        .thumb.active {
            border-color: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Info Section */
        .product-info-wrap {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .product-badge {
            display: inline-block;
            padding: 0.4rem 1rem;
    background: linear-gradient(45deg, #b1682a, #9b2d2d);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 0 20px rgb(0 0 0 / 30%);;
        }

        .product-title {
            font-family: 'Orbitron', monospace;
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 1rem;
background: linear-gradient(45deg, #000000, #040404);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }

        .rating-summary {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stars { color: #ffc107; }
        .review-link { color: #e0e0e0; font-size: 0.9rem; text-decoration: none; transition: 0.3s; }
        .review-link:hover { color: #00d4ff; }

        .price-wrap {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .current-price {
            font-size: 2.2rem;
            font-weight: 800;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .old-price {
            font-size: 1.2rem;
            color: #888;
            text-decoration: line-through;
        }

        .discount-tag {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: #fff;
            padding: 0.3rem 0.8rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.4);
        }

        .description {
            color: #000000;
            line-height: 1.8;
            margin-bottom: 2.5rem;
            font-size: 1.05rem;
            opacity: 0.9;
        }

        /* Purchase Controls */
        .purchase-wrap {
            display: flex;
            gap: 1rem;
            margin-bottom: 2.5rem;
        }

        .qty-picker {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 0.5rem;
            border: 1px solid rgb(0 0 0 / 20%);
        }

        .qty-btn {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            color: #e0e0e0;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .qty-btn:hover { background: rgba(0, 212, 255, 0.2); color: #00d4ff; }

        .qty-input {
            width: 50px;
            text-align: center;
            border: none;
            background: transparent;
            font-weight: 700;
            font-size: 1.1rem;
            color: #fff;
        }

        .add-to-cart-btn {
            flex: 1;
            background: linear-gradient(45deg, #ff7600, #090979);
            color: #fff;
            border: none;
            border-radius: 25px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgb(0 0 0 / 30%);
        }

        .add-to-cart-btn:hover {
            background: linear-gradient(45deg, #090979, #00d4ff);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.5);
        }

        .wishlist-btn {
            width: 56px;
            height: 56px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .wishlist-btn:hover, .wishlist-btn.active {
            color: #ff4757;
            border-color: #ff4757;
            background: rgba(255, 71, 87, 0.1);
            box-shadow: 0 0 15px rgba(255, 71, 87, 0.3);
        }

        /* Features */
        .features-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.95rem;
            font-weight: 500;
            color: #0c0b0b;
        }

        .feature-item i { color: #00d4ff; font-size: 1.1rem; text-shadow: 0 0 10px rgba(0, 212, 255, 0.5); }

        /* Tabs Section */
        .product-details-tabs { margin: 5rem 0; }
        .tabs-nav {
            display: flex;
            gap: 3rem;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 2.5rem;
        }

        .tab-link {
            padding: 1rem 0;
            font-weight: 700;
            color: #888;
            text-decoration: none;
            position: relative;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
            transition: 0.3s;
        }

        .tab-link:hover { color: #e0e0e0; }
        .tab-link.active { color: #000000 }
        .tab-link.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 100%;
            height: 2px;
            background: #1b1e1f;
            box-shadow: 0 0 10px #bd7e7e;
        }

        /* Review Section */
        .review-form-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 3rem;
        }

        .rating-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .rating-input i { font-size: 1.5rem; cursor: pointer; color: #444; transition: all 0.3s ease; }
        .rating-input i.active { color: #ffc107; text-shadow: 0 0 10px rgba(255, 193, 7, 0.5); }

        .review-textarea {
            width: 100%;
            height: 120px;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            font-family: inherit;
            resize: none;
            color: #000000;
        }

        .review-btn {
            background: linear-gradient(45deg, #e5850e, #090979);
            color: #fff;
            border: none;
            padding: 0.8rem 2rem;
            border-radius: 25px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .review-btn:hover {
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
        }

        .review-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .reviewer-info { display: flex; gap: 1rem; align-items: center; }
        .reviewer-avatar { 
            width: 48px; 
            height: 48px; 
            border-radius: 50%; 
            background: linear-gradient(45deg, #00d4ff, #090979); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 800;
            color: #fff;
        }
        .reviewer-name { font-weight: 700; color: #00d4ff; }
        .review-date { font-size: 0.85rem; color: #888; }

        /* Similar Products */
        .similar-section { padding-bottom: 5rem; }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2.5rem;
        }
        
        .section-header h2 {
            font-family: 'Orbitron', monospace;
    color: #020202;
    text-shadow: 0 0 10px rgb(6 6 6 / 50%);
        }

        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .mini-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-decoration: none;
            color: inherit;
            transition: all 0.3s ease;
        }

        .mini-card:hover { 
            transform: translateY(-5px); 
            border-color: #00d4ff;
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
        }
        
        .mini-card img { 
            width: 100%; 
            aspect-ratio: 1; 
            object-fit: contain; 
            border-radius: 10px; 
            margin-bottom: 1rem; 
            background: rgba(255, 255, 255, 0.05);
        }
        
        .mini-name { 
            font-weight: 700; 
            margin-bottom: 0.5rem; 
            display: -webkit-box; 
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical; 
            overflow: hidden; 
            height: 2.8em;
            color: #fff;
        }
        
        .mini-price { color: #00d4ff; font-weight: 800; }

        @media (max-width: 992px) {
            .product-main { grid-template-columns: 1fr; gap: 3rem; }
            .gallery-wrap { position: static; }
            .product-title { font-size: 2rem; }
        }

        @media (max-width: 576px) {
            .purchase-wrap { flex-direction: column; }
            .add-to-cart-btn { padding: 1rem; }
            .tabs-nav { gap: 1.5rem; overflow-x: auto; }
        }
        .mu {
            background: linear-gradient(180deg,#ffffff 0%, #ffffff 100%);
        }
    </style>
</head>
<body class="mu">

    <header class="sticky top-0 z-50 bg-surface-light dark:bg-surface-dark shadow-sm">
    <div class="px-4 py-3 flex items-center justify-between gap-3">
    <a class="p-2 text-slate-500 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition-colors" href="wishlist.html">
    <span class="material-icons-outlined text-2xl">favorite_border</span>
    <a href="wishlist.html" class="absolute inset-0"></a>
    </a>
    <div class="flex-1 relative">
    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
    <span class="material-icons-outlined text-slate-400 text-xl">search</span>
    </div>
    <input class="block w-full pl-10 pr-3 py-2 border border-slate-200 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-800 text-sm placeholder-slate-400 focus:outline-none focus:border-secondary dark:focus:border-primary focus:ring-1 focus:ring-secondary dark:focus:ring-primary transition-colors" id="home-search" placeholder="What are you looking for?" type="text"/>
    </div>
    <div class="flex items-center gap-2">
    <div class="text-secondary dark:text-white font-black text-2xl tracking-tighter flex items-center">
    <span class="text-primary mr-1">
    <span class="material-icons-outlined align-middle text-2xl">shopping_bag</span>
    </span>
                    BODA
                </div>

    </div>
    </div>

    </div>
    </header>

    <main class="w-full max-w-md mx-auto sm:max-w-full">
                <!-- Replaced top product section with TFASIL product card -->
                <div class="max-w-5xl min-h-screen m-auto flex items-center md:px-7 px-3 py-7">
                    <div class="w-full grid md:grid-cols-2 grid-cols-1 gap-5 bg-white shadow-xl rounded-2xl md:overflow-visible overflow-hidden">
                        <div class="bg-[#afde3d] relative p-3 rounded-tl-2xl md:rounded-bl-2xl">
                            <img id="mainImage" src="../tfasil/src/assets/nike-gr.png" alt="Nike Shoe Image" class="md:absolute md:scale-[1.2] scale-90 md:-skew-y-12 md:top-[50%] md:-translate-y-[50%] lg:-left-0.5 md:animate-[scaleupMD_2s_linear] animate-[scaleupSM_2s_linear]" />
                        </div>
                        <!-- Thumbnails (populated from product images) -->
                        <div class="thumbs-grid mt-3" id="thumbnailGallery" style="display:none; grid-template-columns: repeat(5, 1fr); gap:0.6rem;"></div>

                        <div class="p-5 md:ps-0">
                            <div class="product-badge" id="productCategory">...</div>
                            <h2 id="productTitle" class="capitalize md:text-4xl text-3xl font-semibold tracking-wider mb-4">nike shoes</h2>

                            <div class="md:flex justify-between mb-3">
                                <h3 id="productPrice" class="md:text-3xl text-2xl">$462.44</h3>

                                <div class="flex items-center">
                                    <div class="mr-2">
                                        <i class="fa-solid fa-star text-amber-500 md:text-base text-sm"></i>
                                        <i class="fa-solid fa-star text-amber-500 md:text-base text-sm"></i>
                                        <i class="fa-solid fa-star text-amber-500 md:text-base text-sm"></i>
                                        <i class="fa-solid fa-star text-amber-500 md:text-base text-sm"></i>
                                        <i class="fa-regular fa-star text-amber-500 md:text-base text-sm"></i>
                                    </div>
                                    <span class="text-slate-600 text-sm">(3410 Reviews)</span>
                                </div>
                            </div>

                            <hr class="border-0 bg-slate-300 h-[2px]" />

                            <div class="md:px-4">
                                <div class="my-5">
                                    <h3 class="capitalize text-lg font-semibold">product description</h3>
                                      <p id="productDescription" class="text-slate-700 md:ps-4">Lorem ipsum dolor sit amet consectetur adipisicing elit. Eligendi, fuga! Architecto aspernatur facilis, iusto minima nulla quod esse beatae ex illum ipsa soluta quia dolores reprehenderit dicta ut ullam et error facere quae.</p>
                                </div>
                                    </div>
                                </div>

                                <div class="flex items-center gap-6 mt-10">
                                    <button class="bg-[#afde3d] py-2 px-10 capitalize rounded-md text-lg hover:bg-[#94cc12] cursor-pointer">buy now <i class="fa-solid fa-cart-shopping"></i></button>

                                    <button class="text-red-800 bg-red-200 hover:bg-red-300 px-3 py-2 text-lg rounded-md cursor-pointer"><i class="fa-solid fa-heart"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

        <!-- Reviews Section -->
        <section class="product-details-tabs" id="reviews">
            <div class="tabs-nav">
                <div class="tab-link active">ÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿßÿ™ ŸàÿßŸÑÿ™ŸÇŸäŸäŸÖÿßÿ™</div>
            </div>
            
            <div class="review-form-card">
                <h3 style="margin-bottom: 1rem; color: #fff;">ÿ£ÿ∂ŸÅ ÿ±ÿ£ŸäŸÉ</h3>
                <div class="rating-input" id="starInput">
                    <i class="fa-solid fa-star" data-val="1"></i>
                    <i class="fa-solid fa-star" data-val="2"></i>
                    <i class="fa-solid fa-star" data-val="3"></i>
                    <i class="fa-solid fa-star" data-val="4"></i>
                    <i class="fa-solid fa-star" data-val="5"></i>
                </div>
                <textarea class="review-textarea" id="reviewText" placeholder="ÿßŸÉÿ™ÿ® ÿ™ÿ¨ÿ±ÿ®ÿ™ŸÉ ŸÖÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ ŸáŸÜÿß..."></textarea>
                <button class="review-btn" onclick="submitReview()">ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ™ŸÇŸäŸäŸÖ</button>
            </div>

            <div class="tabs-content" id="reviewsContainer">
                <!-- Dynamic reviews -->
            </div>
        </section>

        <!-- Similar Products -->
        <section class="similar-section">
            <div class="section-header">
                <h2>ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖÿ¥ÿßÿ®Ÿáÿ©</h2>
            </div>
            <div class="product-grid" id="similarProducts">
                <!-- Dynamic -->
            </div>
        </section>
    </main>
    <nav class="fixed bottom-0 w-full bg-white dark:bg-surface-dark border-t border-gray-200 dark:border-gray-800 pb-safe pt-2 px-6 z-50">
<div class="flex justify-between items-center pb-4">
    <a class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" href="empty-cart.html">
<span class="material-icons-outlined text-2xl">shopping_cart</span>
<span class="text-[10px]">Cart</span>

<a class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" href="ahsab.html">
<span class="material-icons-outlined text-2xl">person</span>
<span class="text-[10px]">Account</span>
</a>

<a class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" href="products.html">
<span class="material-icons-outlined text-2xl">category</span>
<span class="text-[10px]">Categories</span>
</a>
</a>

<a class="flex flex-col items-center gap-1 text-gray-400 dark:text-gray-500" href="home.html">
<span class="material-icons-outlined text-2xl">home</span>
<span class="text-[10px]">Home</span>
</a>


</div>
</nav>

    <script src="../assets/vendor/supabase/supabase-js@2.js"></script>
    <script src="../assets/js/mock-api.js"></script>
    <script src="../assets/js/store.js"></script>
    <script src="../assets/js/script.js"></script>
    <script src="../assets/js/product-detail.js"></script>
<script src="../assets/js/home.js"></script>
    <script src="../tfasil/main.js"></script>
    <!-- Import products from main.js -->
    <script src="main.js"></script>
    <script>
        // ... (Existing JS Logic)
        let currentProduct = null;
        let currentRating = 0;

        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            if (!productId) {
                window.location.href = 'products.html';
                return;
            }

            // Enhanced product loading - support both store.js and main.js products
            let currentProduct = getProductById(productId);
            
            // If not found in store, try to find in main.js products
            if (!currentProduct && typeof products !== 'undefined') {
                const mainProduct = products.find(p => p.id == productId);
                if (mainProduct) {
                    // Convert main.js format to store format
                    currentProduct = {
                        id: mainProduct.id.toString(),
                        name: mainProduct.title,
                        category: mainProduct.category,
                        price: parseFloat(mainProduct.price.replace('$', '')),
                        description: mainProduct.description,
                        image: mainProduct.img,
                        images: [mainProduct.img]
                    };
                    console.log('‚úÖ Found product from main.js:', currentProduct);
                }
            }
            
            if (!currentProduct) {
                alert('ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØ');
                window.location.href = 'products.html';
                return;
            }

            renderProductDetails(currentProduct);
            loadReviews(productId);
            
            // Load similar products with a small delay to ensure all scripts are loaded
            setTimeout(() => {
                loadSimilarProducts(currentProduct.category, currentProduct.id);
            }, 100);
            
            checkWishlistStatus(productId);
            
            // Star rating interaction
            document.querySelectorAll('.rating-input i').forEach(star => {
                star.addEventListener('click', function() {
                    const val = parseInt(this.dataset.val);
                    currentRating = val;
                    updateStarInput(val);
                });
            });
        });

        function renderProductDetails(p) {
            console.log('renderProductDetails:', p && p.id, p && p.name);
            // Store current product globally for button handlers
            currentProduct = p;
            
            document.title = `${p.name} - BODA`;
            const titleEl = document.getElementById('productTitle');
            if (titleEl) titleEl.textContent = p.name;
            const catEl = document.getElementById('productCategory');
            if (catEl) catEl.textContent = p.category;
            
            // Pricing
            const priceEl = document.getElementById('productPrice');
            const originalPriceEl = document.getElementById('originalPrice');
            const discountBadge = document.getElementById('discountBadge');

            if (p.discountPrice && p.discountPrice < p.price) {
                if (priceEl) priceEl.textContent = `${p.discountPrice.toFixed(2)} ÿ¨.ŸÖ`;
                if (originalPriceEl) {
                    originalPriceEl.textContent = `${p.price.toFixed(2)} ÿ¨.ŸÖ`;
                    originalPriceEl.style.display = 'inline-block';
                }
                const pct = Math.round(((p.price - p.discountPrice) / p.price) * 100);
                if (discountBadge) {
                    discountBadge.textContent = `-${pct}%`;
                    discountBadge.style.display = 'inline-block';
                }
            } else {
                if (priceEl) priceEl.textContent = `${p.price.toFixed(2)} ÿ¨.ŸÖ`;
                if (originalPriceEl) originalPriceEl.style.display = 'none';
                if (discountBadge) discountBadge.style.display = 'none';
            }

            document.getElementById('productDescription').textContent = p.description || 'ŸÑÿß ŸäŸàÿ¨ÿØ ŸàÿµŸÅ ŸÖÿ™ÿßÿ≠ ŸÑŸáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨.';
            
            // Images
            const mainImg = document.getElementById('mainImage');
            if (mainImg) mainImg.src = getImagePath(p.image || p.images?.[0] || '../tfasil/src/assets/nike-gr.png');

            // Also populate TFASIL-specific elements (if present)
            const tfTitle = document.getElementById('productTitle');
            const tfPrice = document.getElementById('productPrice');
            const tfDesc = document.getElementById('productDescription');
            const tfCategory = document.getElementById('productCategory');
            if (tfTitle) tfTitle.textContent = p.name;
            if (tfPrice) tfPrice.textContent = (p.discountPrice && p.discountPrice < p.price) ? `${p.discountPrice.toFixed(2)} ÿ¨.ŸÖ` : `${p.price.toFixed(2)} ÿ¨.ŸÖ`;
            if (tfDesc) tfDesc.textContent = p.description || tfDesc.textContent;
            if (tfCategory) tfCategory.textContent = p.category || tfCategory.textContent;
            
            // Thumbs
            const thumbsContainer = document.getElementById('thumbnailGallery');
            let productImages = [];
            
            if (p.images && p.images.length > 0) {
                productImages = p.images;
            } else if (p.image) {
                productImages = [p.image];
            }

            if (productImages.length > 1) {
                    // create thumbnails programmatically to avoid path/onclick issues
                    thumbsContainer.innerHTML = '';
                    productImages.forEach((img, i) => {
                        const div = document.createElement('div');
                        div.className = `thumb ${i === 0 ? 'active' : ''}`;
                        const im = document.createElement('img');
                        const src = getImagePath(img);
                        im.src = src;
                        im.alt = `thumb-${i}`;
                        div.appendChild(im);
                        div.addEventListener('click', () => {
                            switchImage(div, src);
                        });
                        thumbsContainer.appendChild(div);
                    });
                    thumbsContainer.style.display = 'grid';
            } else {
                thumbsContainer.style.display = 'none';
            }

            // Rating
            document.getElementById('productRatingStars').innerHTML = renderStars(p.rating);
            document.getElementById('reviewCount').textContent = p.reviewCount || 0;
            
            // Stock Status
            if (p.stockStatus === 'out_of_stock') {
                const cartBtn = document.querySelector('.add-to-cart-btn');
                if (cartBtn) {
                    cartBtn.disabled = true;
                    cartBtn.innerHTML = '<i class="fa-solid fa-ban"></i> ŸÜŸÅÿ∞ÿ™ ÿßŸÑŸÉŸÖŸäÿ©';
                    cartBtn.style.background = '#444';
                }
            }
        }

        function switchImage(el, src) {
            console.log('switchImage called with src:', src);
            document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            
            const mainImg = document.getElementById('mainImage');
            mainImg.style.opacity = 0;
            setTimeout(() => {
                mainImg.src = src;
                mainImg.style.opacity = 1;
            }, 200);
        }

        function updateQty(delta) {
            const input = document.getElementById('quantity');
            let val = parseInt(input.value) + delta;
            if (val < 1) val = 1;
            input.value = val;
        }

        function addToCartClick() {
            const qty = parseInt(document.getElementById('quantity').value);
            addToCart(currentProduct, qty);
            updateCartCount();
            
            // Animation for button
            const btn = document.querySelector('.add-to-cart-btn');
            const originalContent = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-check"></i> ÿ™ŸÖÿ™ ÿßŸÑÿ•ÿ∂ÿßŸÅÿ©';
            btn.style.background = 'linear-gradient(45deg, #2ecc71, #27ae60)';
            
            setTimeout(() => {
                btn.innerHTML = originalContent;
                btn.style.background = '';
            }, 2000);
        }

        function handleToggleWishlist() {
            const btn = document.getElementById('wishlistBtn');
            toggleWishlist(currentProduct.id);
            btn.classList.toggle('active');
            
            if(btn.classList.contains('active')) {
                btn.innerHTML = '<i class="fa-solid fa-heart"></i>';
            } else {
                btn.innerHTML = '<i class="fa-regular fa-heart"></i>';
            }
        }

        function checkWishlistStatus(id) {
            const wishlist = getWishlist();
            const btn = document.getElementById('wishlistBtn');
            if (wishlist.some(p => p.id === id)) {
                btn.classList.add('active');
                btn.innerHTML = '<i class="fa-solid fa-heart"></i>';
            } else {
                btn.classList.remove('active');
                btn.innerHTML = '<i class="fa-regular fa-heart"></i>';
            }
        }

        function updateStarInput(val) {
            document.querySelectorAll('.rating-input i').forEach(star => {
                const sVal = parseInt(star.dataset.val);
                if (sVal <= val) star.classList.add('active');
                else star.classList.remove('active');
            });
        }

        function submitReview() {
            if (currentRating === 0) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ÿßÿÆÿ™Ÿäÿßÿ± ÿ™ŸÇŸäŸäŸÖ');
                return;
            }
            const text = document.getElementById('reviewText').value;
            if (!text.trim()) {
                alert('ÿßŸÑÿ±ÿ¨ÿßÿ° ŸÉÿ™ÿßÿ®ÿ© ÿ™ÿπŸÑŸäŸÇ');
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');

            const newReviewObj = {
                name: 'ÿ£ŸÜÿß (ÿπŸÖŸäŸÑ ŸÖŸàÿ´ŸÇ)',
                rating: currentRating,
                date: new Date().toISOString().split('T')[0],
                text: text
            };

            // Save to localStorage
            const reviewsKey = `boda_reviews_${productId}`;
            const existingReviews = JSON.parse(localStorage.getItem(reviewsKey) || '[]');
            existingReviews.unshift(newReviewObj);
            localStorage.setItem(reviewsKey, JSON.stringify(existingReviews));

            // Refresh display
            displayReviews(existingReviews);
            
            // Reset form
            document.getElementById('reviewText').value = '';
            currentRating = 0;
            updateStarInput(0);
            alert('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ™ŸÇŸäŸäŸÖŸÉ ÿ®ŸÜÿ¨ÿßÿ≠!');
        }

        function loadReviews(id) {
            const reviewsKey = `boda_reviews_${id}`;
            let reviews = JSON.parse(localStorage.getItem(reviewsKey) || '[]');
            
            // If no reviews in localStorage, check if product has default reviews
            if (reviews.length === 0 && currentProduct && currentProduct.reviews) {
                reviews = currentProduct.reviews;
            }

            displayReviews(reviews);
        }

        function displayReviews(reviews) {
            const container = document.getElementById('reviewsContainer');
            if (!reviews || reviews.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888; padding: 2rem;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ™ŸÇŸäŸäŸÖÿßÿ™ ŸÑŸáÿ∞ÿß ÿßŸÑŸÖŸÜÿ™ÿ¨ ÿ®ÿπÿØ. ŸÉŸÜ ÿ£ŸàŸÑ ŸÖŸÜ ŸäŸÇŸäŸÖŸá!</p>';
                return;
            }

            container.innerHTML = reviews.map(r => `
                <div class="review-card">
                    <div class="review-header">
                        <div class="reviewer-info">
                            <div class="reviewer-avatar">${r.name.charAt(0)}</div>
                            <div>
                                <div class="reviewer-name">${r.name}</div>
                                <div class="review-date">${r.date}</div>
                            </div>
                        </div>
                        <div class="stars">${renderStars(r.rating)}</div>
                    </div>
                    <p style="color: #e0e0e0;">${r.text}</p>
                </div>
            `).join('');
            
            // Update the review count in UI
            const countEl = document.getElementById('reviewCount');
            if (countEl) {
                countEl.textContent = reviews.length;
            }
        }

        function loadSimilarProducts(category, excludeId) {
            console.log('üîç loadSimilarProducts called with category:', category, 'excludeId:', excludeId);
            
            let allProducts = [];
            
            // Get products from main.js
            console.log('üì¶ Checking for products array...');
            if (typeof products !== 'undefined' && Array.isArray(products)) {
                console.log(`‚úÖ Found ${products.length} products from main.js`);
                allProducts = allProducts.concat(products);
            }
            
            // Get products from store.js
            try {
                if (typeof getAllProducts === 'function') {
                    const storeProducts = Object.values(getAllProducts());
                    console.log(`‚úÖ Found ${storeProducts.length} products from store.js`);
                    allProducts = allProducts.concat(storeProducts);
                }
            } catch (e) {
                console.warn('Could not load store products:', e);
            }
            
            console.log(`üìä Total products loaded: ${allProducts.length}`);
            
            // Convert excludeId to string for comparison
            const excludeIdStr = String(excludeId);
            
            // Filter similar products
            const similar = allProducts.filter(p => {
                const pCategory = String(p.category || '');
                const pIdStr = String(p.id || '');
                const matches = pCategory === category && pIdStr !== excludeIdStr;
                if (matches) {
                    console.log(`‚úÖ Matched: ${p.title || p.name} (id: ${pIdStr}, category: ${pCategory})`);
                }
                return matches;
            }).slice(0, 4);
            
            console.log(`üéØ Found ${similar.length} similar products in category "${category}"`);
            
            const container = document.getElementById('similarProducts');
            if (!container) {
                console.error('‚ùå Container #similarProducts not found!');
                return;
            }
            
            if (similar.length === 0) {
                console.warn('‚ö†Ô∏è No similar products found');
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 2rem; grid-column: 1/-1;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÖÿ¥ÿßÿ®Ÿáÿ© ÿ≠ÿßŸÑŸäÿßŸã.</p>';
                return;
            }

            console.log('üé® Rendering similar products...');
            container.innerHTML = similar.map(p => {
                const name = p.name || p.title || 'ŸÖŸÜÿ™ÿ¨ ÿ®ÿØŸàŸÜ ÿßÿ≥ŸÖ';
                let imageSrc = p.image || p.img || '';
                
                if (typeof getImagePath === 'function') {
                    try {
                        imageSrc = getImagePath(imageSrc);
                    } catch (e) {
                        console.warn('Could not get image path:', e);
                    }
                }
                
                let price = p.price;
                if (typeof price === 'string') {
                    price = parseFloat(price.replace(/[$ÿ¨\.ŸÖ]/g, '') || '0');
                }
                const formattedPrice = isNaN(price) ? '0.00' : parseFloat(price).toFixed(2);
                
                console.log(`  üì¶ ${name} - ${formattedPrice}`);
                
                return `
                    <a href="product.html?id=${p.id}" class="mini-card" title="${name}">
                        <img src="${imageSrc}" alt="${name}" onerror="this.src='../tfasil/src/assets/nike-gr.png'">
                        <div class="mini-name">${name}</div>
                        <div class="mini-price">${formattedPrice} ÿ¨.ŸÖ</div>
                    </a>
                `;
            }).join('');
            
            console.log('‚ú® Similar products rendered successfully!');
        }
</script>

</body>
</html>
